function export_settings
  set -l stamp (date +"%0Y%0j_%0H%0M")
  set -l main_export_folder (echo -ns $guirguis_external_drive 'exported_linux_settings')
  set -l other_export_folders /mnt/d/exported_linux_settings /mnt/c/Users/guirg/exported_linux_settings ~/exported_linux settings
  set -l export_name (echo -ns 'exported_' (hostname) '_')
  set -l export_folder_name (echo -ns $main_export_folder '/' $export_name)
  set -l tar_name (echo -ns $export_folder_name '.tar')
  set -l export_file_list ~/.vim/ ~/.vimrc ~/.emacs.d/ ~/.bash/ ~/.bashrc ~/.config/ ~/scripts/ ~/.local/ ~/.profile/ ~/.pip/ ~/pythonrc ~/.jupyter/ ~/.ipython/ $argv
  set -l final_truncated_file_list
  set -l final_file_list
  set -l skipped_file_list
  set -l home_folder (echo -ns $HOME '/')

  if not timeout 3 mkdir -p $main_export_folder
    for folder_attempt in $other_export_folders
      set main_export_folder $folder_attempt
      if mkdir -p $main_export_folder; break; end
    end
  end

  set -l rsync_export_folder (echo -ns $main_export_folder '/' (hostname) '.rsync')

  if not test -e $main_export_folder
    echo 'Error: could not create export folder'
    return 1
  end

  echo -s "[01;34mexporting settings to: [0m" $main_export_folder

  for file in $export_file_list
    if contains $file $final_truncated_file_list
      continue
    end
    if test -e $file
      set final_file_list $final_file_list $file
      set file (string replace $home_folder '' $file)
      set final_truncated_file_list $final_truncated_file_list $file
    else
      set skipped_file_list $skipped_file_list $file
    end
  end

  if test -n (echo $skipped_file_list)
    echo "[01;34mskipping:[0m" $skipped_file_list
  end

  echo -n "[01;34mtaring files: [0m[0m"
  tar --update --file $tar_name --directory $HOME  --totals --warning=none --ignore-failed-read --exclude='*~' --sort=name $final_truncated_file_list
  echo -n "[01;34mrsyncing files: [0m[0m"
  rsync -ruz --ignore-errors --delete --exclude='*~' --exclude='/.cache/' --delete-excluded ~/ $rsync_export_folder
  # rsync -ruz --ignore-errors --delete --exclude='*~' ~/ (echo -ns $main_export_folder '/' (hostname) '.rsync')
  echo "[01;34mdone[0m[0m"
  return 0

end

